<!DOCTYPE html>
<html>
    <head>
        







<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <link rel="shortcut icon" href="/images/favicon-16x16.png" />


<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
    href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet"
/>
<link
    href="https://cdn.jsdelivr.net/npm/@fontsource/cascadia-code@4.2.1/index.min.css"
    rel="stylesheet"
/>


<link rel="stylesheet" href="/styles/main.css">


    
<link rel="stylesheet" href="/styles/post.css">



<title>IMU 101 - Try &amp; Err</title>

    <meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Try & Err" type="application/atom+xml">
</head>
    <body>
        <header>
    <h1>Try &amp; Err</h1>
    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            
                
                    <li>
                        <a href="/tags"
                            ><span>Tags</span></a
                        >
                    </li>
                
                    <li>
                        <a href="/categories"
                            ><span>Categories</span></a
                        >
                    </li>
                
                    <li>
                        <a href="/archives"
                            ><span>Archives</span></a
                        >
                    </li>
                
            
        </ul>
    </nav>
</header>

        <main>
    <header>
        <h1>
            
                IMU 101
            
        </h1>
        <div>
            <time>2022-12-10</time>
            <div class="post-categories">
                
                    <span class="category-tree">
                        
                            <span class="separator">/</span>
                            <a href="/categories/Project/">Project</a>
                        
                    </span>
                
            </div>
            <div class="post-tags">
                
                    <span class="tag">
                        <span class="separator">#</span>
                        <a href="/tags/STM32/">STM32</a>
                    </span>
                
                    <span class="tag">
                        <span class="separator">#</span>
                        <a href="/tags/Python/">Python</a>
                    </span>
                
                    <span class="tag">
                        <span class="separator">#</span>
                        <a href="/tags/C/">C</a>
                    </span>
                
            </div>
        </div>
    </header>
    <h1 id="IMU-101"><a href="#IMU-101" class="headerlink" title="IMU 101"></a>IMU 101</h1><h3 id="What-is-IMU"><a href="#What-is-IMU" class="headerlink" title="What is IMU?"></a>What is IMU?</h3><ul>
<li>IMU ＝ inertia measurement unit</li>
<li>3-axis accelerometer＋3-axis gyroscopes</li>
</ul>
<img src="./uRxtdgW.png" width="500">

<p><font style="font-size: 10px">source: <a target="_blank" rel="noopener" href="https://www.ceva-dsp.com/ourblog/what-is-an-imu-sensor/">https://www.ceva-dsp.com/ourblog/what-is-an-imu-sensor/</a><br></font></p>
<h2 id="為什麼需要濾波？"><a href="#為什麼需要濾波？" class="headerlink" title="為什麼需要濾波？"></a>為什麼需要濾波？</h2><p>加速度計會產生高頻振蕩的噪音訊號，又陀螺儀是將角速度對時間積分產生角度，故<strong>易產生誤差</strong>。</p>
<p><img src="/2022/12/10/imu101/x1Xlfsk.png"></p>
<p><font style="font-size:
10px;">source: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1586658/combine-gyroscope-and-accelerometer-data">https://stackoverflow.com/questions/1586658/combine-gyroscope-and-accelerometer-data</a></font></p>
<h2 id="互補濾波"><a href="#互補濾波" class="headerlink" title="互補濾波"></a>互補濾波</h2><h3 id="Complementary-filter"><a href="#Complementary-filter" class="headerlink" title="Complementary filter"></a>Complementary filter</h3><ul>
<li>加速度計計算瞬時傾角誤差比較大</li>
<li>陀螺儀積分結果易受長時間影響</li>
</ul>
<p><strong>定時</strong>對加速度採樣的角度取平均值 + <strong>短時間</strong>內採用陀螺儀得到的角度</p>
<p>加速度計要濾掉高頻訊號，陀螺儀要濾掉低頻訊號</p>
<p><img src="/2022/12/10/imu101/94sdzbz.png"><br><font style="font-size: 10px;"><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1586658/combine-gyroscope-and-accelerometer-data">https://stackoverflow.com/questions/1586658/combine-gyroscope-and-accelerometer-data</a></font></p>
<p>$$<br>\text{angle’} &#x3D; \alpha(\text{angle} + \text{gyro} \times dt) + (1-\alpha)\times(X_a)<br>$$</p>
<ul>
<li>\(\text{gyro}\) 為陀螺儀值(角速度)， \(dt\) 為計算週期</li>
<li>\(X_A\) 為加速度數據換算後的角度值</li>
<li>\(\alpha &#x3D; 0.98\)</li>
</ul>
<h2 id="卡爾曼濾波"><a href="#卡爾曼濾波" class="headerlink" title="卡爾曼濾波"></a>卡爾曼濾波</h2><h3 id="Kalman-filter"><a href="#Kalman-filter" class="headerlink" title="Kalman filter"></a>Kalman filter</h3><ul>
<li>線性</li>
<li>純時域</li>
<li>高斯雜訊</li>
</ul>
<h3 id="基本模型-真實狀態"><a href="#基本模型-真實狀態" class="headerlink" title="基本模型-真實狀態"></a>基本模型-真實狀態</h3><p>$$<br>\displaylines{<br>  x_k &#x3D; Fx_{k-1}+Bu_k+w_k \\<br>  w_k \sim N(0,\ Q_k)<br>}<br>$$</p>
<ul>
<li>\(x_k\) : \(k\) 時刻狀態 </li>
<li>\(F\) : 狀態變換矩陣</li>
<li>\(u_k\) : 控制向量</li>
<li>\(B\) : 控制輸入模型</li>
<li>\(w_k\) : 過程雜訊</li>
<li>\(Q_k\) : \(w_k\) 的共變異數矩陣</li>
</ul>
<h3 id="基本模型-觀測"><a href="#基本模型-觀測" class="headerlink" title="基本模型-觀測"></a>基本模型-觀測</h3><p>$$<br>\displaylines{<br>  z_k &#x3D; Hx_k + v_k \\<br>  v_k \sim N(0, R_k)<br>}<br>$$</p>
<ul>
<li>\(z_k\) : \(k\) 時刻測量到的狀態</li>
<li>\(H\) : 觀測模型</li>
<li>\(v_k\) : 觀測誤差</li>
<li>\(R_k\) : \(v_k\) 的共變異數矩陣</li>
</ul>
<h3 id="預測"><a href="#預測" class="headerlink" title="預測"></a>預測</h3><p>$$<br>\displaylines{<br>  \hat{x}_ k^{-} &#x3D; F\hat{x}_{k-1}+B\dot{\theta}_k \\<br>}<br>$$</p>
<ul>
<li>\(F&#x3D;<br>  \begin{bmatrix}<br>  1 &amp; -\Delta t \\<br>  0 &amp; 1<br>  \end{bmatrix} \<br>  \hat{x}_k &#x3D;<br>  \begin{bmatrix}<br>  \theta \\<br>  \dot{\theta}_b<br>  \end{bmatrix}_k \<br>  B&#x3D;<br>  \begin{bmatrix}<br>  \Delta t \\<br>  0<br>  \end{bmatrix}\)</li>
<li>\(P_k\) : \(x_k\) 的誤差共變異數矩陣<ul>
<li>\(P_k &#x3D; E[(x_k - E[x_k])(x_k - E[x_k])^T]\)</li>
<li>\(cov(AX+B,\ AX+B) &#x3D; var(AX+B)\ &#x3D; A\ var(X)\ A^T\)</li>
</ul>
</li>
</ul>
<h3 id="修正"><a href="#修正" class="headerlink" title="修正"></a>修正</h3><p>$$<br>\displaylines{<br>  K_k &#x3D; P_k^-H^T(HP^-_kH^T+R)^{-1} \\<br>  \hat{x}_k &#x3D; \hat{x}^-_k + K_k(z_k-H\hat{x}_k^-) \\<br>  P_k &#x3D; (I-K_kH)P^-_k<br>}<br>$$</p>
<ul>
<li>\(K_k\) : 卡爾曼增益 (最小化\(P_k\))</li>
<li>\(H &#x3D;<br>  \begin{bmatrix}<br>  1 &amp; 0<br>  \end{bmatrix}\)</li>
</ul>
<p><img src="/2022/12/10/imu101/7OP0UBt.png"></p>
<h2 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h2><h3 id="裝置-流程"><a href="#裝置-流程" class="headerlink" title="裝置&amp;流程"></a>裝置&amp;流程</h3><img src="./edJJ7RM.png" width="650">

<img src="./px2mxKe.jpg" height="650">

<h3 id="測試結果-Part-1"><a href="#測試結果-Part-1" class="headerlink" title="測試結果 Part 1"></a>測試結果 Part 1</h3><p><img src="/2022/12/10/imu101/o9QcK44.gif"></p>
<h3 id="測試結果-Part-2"><a href="#測試結果-Part-2" class="headerlink" title="測試結果 Part 2"></a>測試結果 Part 2</h3><table>
<thead>
<tr>
<th>Pitch</th>
<th>Row</th>
</tr>
</thead>
<tbody><tr>
<td><img src="/2022/12/10/imu101/kqVK3qr.png"></td>
<td><img src="/2022/12/10/imu101/jM9T7T6.png"></td>
</tr>
</tbody></table>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><font style="font-size: 13px;">

<p><a target="_blank" rel="noopener" href="https://www.cs.unc.edu/~welch/media/pdf/kalman_intro.pdf">Welch, G. and Bishop, G. (2006). <em>An Introduction to the Kalman Filter</em>, Department of Computer Science University of North Carolina at Chapel Hill</a><br><a target="_blank" rel="noopener" href="http://blog.tkjelectronics.dk/2012/09/a-practical-approach-to-kalman-filter-and-how-to-implement-it/">Lauszus. (2012). <em>A practical approach to Kalman filter and how to implement it</em>, TKJ Electronics</a></p>
</font>

    <div class="gallery">
        
    </div>
</main>

        
    <nav class="pagination">
        <span class="prev">
            
                <a href="/2023/02/09/dns-sinkhole/">
                    DNS sinkhole
                </a>
            
        </span>
        <span class="next">
            
        </span>
    </nav>


        <footer>
    <p>&copy; Pierre</p>
    <p>
        Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>,
        <a target="_blank" rel="noopener" href="https://github.com/sunnybyeon/hexo-theme-dashed">Theme</a> by
        <a target="_blank" rel="noopener" href="https://github.com/sunnybyeon">sunnybyeon</a>
    </p>
    
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [['$$', '$$'],['\\[','\\]']],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js "></script>

    
</footer>

    </body>
</html>
